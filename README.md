# Service Skeleton

Скелетон для создания Go микросервисов в рамках платформы GenDO.

## Особенности

- ✅ Структурированное логирование с Logrus
- ✅ Трассировка запросов с OpenTelemetry + Jaeger
- ✅ Метрики Prometheus с кастомными коллекторами
- ✅ HTTP сервер на Chi с настраиваемыми middleware
- ✅ Graceful shutdown
- ✅ Конфигурация через переменные окружения
- ✅ Docker контейнеризация
- ✅ Health check эндпоинты
- ✅ Модульная архитектура с переиспользуемыми пакетами
- ✅ OpenAPI генерация кода с валидацией

## Структура проекта

```
.
├── cmd/
│   └── main.go              # Точка входа в приложение
├── internal/
│   ├── config/              # Конфигурация приложения
│   ├── handlers/            # HTTP обработчики
│   ├── models/              # Модели данных
│   ├── services/            # Бизнес-логика
│   ├── generated/           # Автогенерируемый код
│   │   └── api/            # Сгенерированные API модели
│   ├── api/                # Сгенерированные Chi handlers
│   └── pkg/                # Переиспользуемые пакеты
│       ├── logger/         # Настройка логгера
│       ├── tracing/        # Настройка трассировки
│       ├── metrics/        # Настройка метрик
│       └── server/         # Настройка HTTP сервера
├── api/                     # OpenAPI спецификации
├── Dockerfile               # Docker образ
├── Makefile                 # Команды сборки и генерации
├── env.example              # Пример переменных окружения
├── go.mod                   # Go модули
└── README.md               # Документация
```

## Быстрый старт

1. Скопируйте файл конфигурации:
   ```bash
   cp env.example .env
   ```

2. Установите зависимости:
   ```bash
   go mod download
   ```

3. Запустите сервис:
   ```bash
   go run cmd/main.go
   ```

4. Проверьте работу:
   ```bash
   curl http://localhost:8080/health
   curl http://localhost:8080/api/v1/ping
   ```

## Конфигурация

Основные переменные окружения:

- `PORT` - порт сервера (по умолчанию: 8080)
- `SERVICE_NAME` - имя сервиса для трассировки
- `LOG_LEVEL` - уровень логирования (debug, info, warn, error)
- `JAEGER_ENDPOINT` - эндпоинт Jaeger для трассировки

## Эндпоинты

- `GET /health` - проверка состояния сервиса
- `GET /metrics` - метрики Prometheus
- `GET /api/v1/ping` - тестовый эндпоинт

## Docker

Сборка образа:
```bash
docker build -t service-skeleton .
```

Запуск контейнера:
```bash
docker run -p 8080:8080 --env-file .env service-skeleton
```

## Модульная архитектура

Скелетон использует модульную архитектуру с переиспользуемыми пакетами в `internal/pkg/`:

### Logger (`internal/pkg/logger`)
- Настройка Logrus с JSON/текстовым форматом
- Поддержка уровней логирования
- Контекстное логирование для сервисов

### Tracing (`internal/pkg/tracing`)  
- Настройка OpenTelemetry + Jaeger
- Конфигурируемая частота семплирования
- Автоматическая регистрация глобального tracer

### Metrics (`internal/pkg/metrics`)
- Prometheus метрики с кастомным registry
- HTTP middleware для автоматических метрик
- Методы для создания кастомных метрик

### Server (`internal/pkg/server`)
- Chi router с настраиваемыми middleware
- Методы для регистрации маршрутов
- Graceful shutdown

### Преимущества модульной архитектуры:
- **Переиспользование**: пакеты можно использовать в других сервисах
- **Тестируемость**: каждый пакет можно тестировать независимо  
- **Конфигурируемость**: гибкая настройка каждого компонента
- **Расширяемость**: легко добавлять новые коллекторы, middleware, маршруты

## Разработка

Для разработки нового сервиса на основе этого скелетона:

1. Скопируйте директорию скелетона
2. Обновите `go.mod` с правильным именем модуля
3. Обновите `SERVICE_NAME` в конфигурации
4. Создайте OpenAPI спецификацию в `api/openapi.yaml`
5. Запустите `make generate` для генерации кода
6. Реализуйте бизнес-логику в `internal/services/`
7. Настройте дополнительные метрики и middleware при необходимости
